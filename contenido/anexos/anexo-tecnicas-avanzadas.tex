%% =============================================================================
%% ANEXO: TÉCNICAS AVANZADAS DE LATEX
%% =============================================================================
\chapter{Técnicas Avanzadas de \LaTeX}
\label{anexo:tecnicas-avanzadas}

Este anexo presenta técnicas avanzadas de \LaTeX{} que pueden ser útiles en la 
elaboración de un \gls{tfg} o \gls{tfm}: tablas rotadas, páginas en horizontal,
inclusión de documentos PDF externos, y otras funcionalidades.

%% =============================================================================
\section{Tablas Rotadas (Sideways Tables)}
\label{sec:tablas-rotadas}

Cuando una tabla tiene muchas columnas y no cabe en el ancho de página normal,
se puede rotar \qty{90}{\degree} para aprovechar el alto de la página como ancho.
Para ello se usa el entorno \texttt{sidewaystable} del paquete \texttt{rotating}.

\subsection{Ejemplo de tabla rotada}

El siguiente código genera una tabla que ocupa toda la página en horizontal:

\begin{latexcode}[title={Código de tabla rotada}]
\begin{sidewaystable}
  \centering
  \caption{Comparativa de características por módulo del sistema}
  \label{tab:comparativa-modulos}
  \begin{tabular}{lcccccccccc}
    \toprule
    \textbf{Módulo} & \textbf{Líneas} & \textbf{Clases} & ... \\
    \midrule
    ...
    \bottomrule
  \end{tabular}
\end{sidewaystable}
\end{latexcode}

% La tabla real se muestra a continuación (rotada 90 grados)
\begin{sidewaystable}
  \centering
  \caption{Comparativa completa de características por módulo del sistema desarrollado}
  \label{tab:comparativa-modulos_render}
  \small % Fuente más pequeña para que quepa
  \begin{tabular}{@{}lccccccccc@{}}
    \toprule
    \textbf{Módulo} & 
    \textbf{Líneas} & 
    \textbf{Clases} & 
    \textbf{Funciones} & 
    \textbf{Tests} & 
    \textbf{Cobertura} & 
    \textbf{Complejidad} & 
    \textbf{Memoria} &
    \textbf{Latencia} &
    \textbf{Estado} \\
    \midrule
    Autenticación    & 2.450  & 12 & 45  & 89  & 94\% & Media & 128 MB & 45 ms  & \checkmark \\
    Base de datos    & 3.200  & 18 & 67  & 120 & 91\% & Alta  & 256 MB & 12 ms  & \checkmark \\
    API REST         & 4.100  & 25 & 98  & 156 & 88\% & Media & 192 MB & 23 ms  & \checkmark \\
    Interfaz web     & 5.600  & 45 & 134 & 89  & 72\% & Baja  & 384 MB & 180 ms & En desarrollo \\
    Notificaciones   & 1.800  & 8  & 32  & 67  & 96\% & Baja  & 64 MB  & 8 ms   & \checkmark \\
    Caché            & 980    & 5  & 18  & 45  & 98\% & Baja  & 512 MB & 2 ms   & \checkmark \\
    Logs y métricas  & 1.200  & 6  & 24  & 38  & 85\% & Baja  & 96 MB  & 5 ms   & \checkmark \\
    Procesamiento    & 2.800  & 14 & 56  & 78  & 82\% & Alta  & 768 MB & 350 ms & \checkmark \\
    Exportación      & 1.500  & 9  & 28  & 52  & 90\% & Media & 128 MB & 120 ms & \checkmark \\
    Configuración    & 650    & 4  & 15  & 34  & 100\%& Baja  & 32 MB  & 1 ms   & \checkmark \\
    \midrule
    \textbf{Total}   & \textbf{24.280} & \textbf{146} & \textbf{517} & \textbf{768} & \textbf{87\%} & -- & -- & -- & -- \\
    \bottomrule
  \end{tabular}
\end{sidewaystable}

\subsection{Cuándo usar tablas rotadas}

Las tablas rotadas son útiles cuando:
\begin{itemize}
  \item La tabla tiene más de 8-10 columnas
  \item Los encabezados de columna son largos
  \item Se necesita mostrar datos comparativos extensos
  \item Una tabla horizontal no cabría sin reducir excesivamente el tamaño de fuente
\end{itemize}

%% =============================================================================
\section{Páginas en Horizontal (Landscape)}
\label{sec:paginas-landscape}

Para insertar páginas en orientación horizontal dentro de un documento vertical,
KOMA-Script ofrece una solución nativa que gestiona correctamente la orientación
y el tamaño de página en el PDF. Al usar \texttt{geometry} para los márgenes,
se combina con \verb|\newgeometry| para optimizar el espacio disponible.

\subsection{Método recomendado: Comandos de la plantilla}

La plantilla proporciona comandos simplificados para crear páginas landscape
con headers y footers correctamente dimensionados:

\begin{latexcode}[title={Código para página horizontal (método simplificado)}]
% Iniciar página landscape con margen de 2cm (valor por defecto)
\BeginLandscapePage[2cm]

% Contenido en landscape (puede ocupar varias páginas)
\section{Diagrama de arquitectura}
\begin{figure}[H]
  \centering
  % Diagrama TikZ o imagen amplia
  \caption{Arquitectura del sistema}
\end{figure}

% Restaurar orientación portrait
\EndLandscapePage
\end{latexcode}

\textbf{Ventajas de este método:}
\begin{itemize}
  \item Sintaxis simple con solo dos comandos
  \item El visor PDF muestra la página rotada correctamente (dimensiones reales de página)
  \item Los márgenes se optimizan para aprovechar el espacio landscape
  \item Los encabezados y pies de página funcionan con normalidad
  \item Se puede usar para múltiples páginas consecutivas
\end{itemize}

% Página landscape usando el comando personalizado de la plantilla
\BeginLandscapePage[2cm]  % Margen de 2cm (opcional, es el valor por defecto)

\subsection{Diagrama de flujo del sistema (página horizontal)}

Esta página está en orientación horizontal para mostrar un diagrama amplio.
Los márgenes están optimizados para aprovechar el espacio disponible.

\begin{figure}[H]
  \centering
  \begin{tikzpicture}[
    scale=0.75, transform shape,
    node distance=0.9cm and 1.3cm,
    block/.style={rectangle, draw, fill=blue!10, text width=1.8cm, text centered, 
                  rounded corners, minimum height=0.7cm, font=\footnotesize},
    decision/.style={diamond, draw, fill=yellow!20, text width=1.3cm, 
                     text centered, aspect=2, font=\footnotesize},
    arrow/.style={thick,->,>=stealth}
  ]
    % Nodos
    \node[block] (inicio) {Inicio};
    \node[block, right=of inicio] (auth) {Autenticación};
    \node[decision, right=of auth] (valido) {¿Válido?};
    \node[block, right=of valido] (menu) {Menú};
    \node[block, above right=0.6cm and 1.2cm of menu] (modulo1) {Módulo A};
    \node[block, right=1.2cm of menu] (modulo2) {Módulo B};
    \node[block, below right=0.6cm and 1.2cm of menu] (modulo3) {Módulo C};
    \node[block, right=1.5cm of modulo2] (proceso) {Proceso};
    \node[block, right=of proceso] (resultado) {Resultado};
    \node[decision, right=of resultado] (guardar) {¿Guardar?};
    \node[block, right=of guardar] (bd) {BD};
    \node[block, below=0.6cm of valido] (error) {Error};
    \node[block, below=0.6cm of guardar] (fin) {Fin};
    
    % Flechas
    \draw[arrow] (inicio) -- (auth);
    \draw[arrow] (auth) -- (valido);
    \draw[arrow] (valido) -- node[above, font=\scriptsize] {Sí} (menu);
    \draw[arrow] (valido) -- node[right, font=\scriptsize] {No} (error);
    \draw[arrow] (error) -| (auth);
    \draw[arrow] (menu) -- (modulo1);
    \draw[arrow] (menu) -- (modulo2);
    \draw[arrow] (menu) -- (modulo3);
    \draw[arrow] (modulo1) -| (proceso);
    \draw[arrow] (modulo2) -- (proceso);
    \draw[arrow] (modulo3) -| (proceso);
    \draw[arrow] (proceso) -- (resultado);
    \draw[arrow] (resultado) -- (guardar);
    \draw[arrow] (guardar) -- node[above, font=\scriptsize] {Sí} (bd);
    \draw[arrow] (guardar) -- node[right, font=\scriptsize] {No} (fin);
    \draw[arrow] (bd) |- (fin);
  \end{tikzpicture}
  \caption{Diagrama de flujo completo del sistema en página horizontal}
  \label{fig:diagrama-landscape}
\end{figure}

\vspace{0.3cm}

\begin{table}[H]
  \centering
  \small
  \caption{Matriz de trazabilidad requisitos-módulos (aprovechando el ancho de página landscape)}
  \label{tab:trazabilidad-landscape}
  \begin{tabular}{l|ccccccccccccc}
    \toprule
    & \textbf{RF01} & \textbf{RF02} & \textbf{RF03} & \textbf{RF04} & \textbf{RF05} & 
      \textbf{RF06} & \textbf{RF07} & \textbf{RF08} & \textbf{RF09} & \textbf{RF10} &
      \textbf{RF11} & \textbf{RF12} & \textbf{RF13} \\
    \midrule
    Módulo A & $\bullet$ & $\bullet$ &           & $\bullet$ &           &           & $\bullet$ &           &           & $\bullet$ &           &           & $\bullet$ \\
    Módulo B &           & $\bullet$ & $\bullet$ &           & $\bullet$ & $\bullet$ &           &           & $\bullet$ &           & $\bullet$ &           &           \\
    Módulo C & $\bullet$ &           &           & $\bullet$ &           &           &           & $\bullet$ &           &           &           & $\bullet$ &           \\
    Módulo D &           &           & $\bullet$ &           & $\bullet$ &           & $\bullet$ &           & $\bullet$ &           &           &           & $\bullet$ \\
    Módulo E &           & $\bullet$ &           &           &           & $\bullet$ &           & $\bullet$ &           & $\bullet$ & $\bullet$ &           &           \\
    \bottomrule
  \end{tabular}
\end{table}

% Restaurar orientación portrait
\EndLandscapePage

\subsection{Cuándo usar páginas landscape}

Las páginas en horizontal son apropiadas para:
\begin{itemize}
  \item Diagramas de flujo o arquitectura complejos
  \item Cronogramas o diagramas de Gantt
  \item Matrices de trazabilidad
  \item Capturas de pantalla de aplicaciones
  \item Tablas muy anchas que no justifican rotación completa
\end{itemize}

%% =============================================================================
\section{Inclusión de Documentos PDF Externos}
\label{sec:inclusion-pdf}

El paquete \texttt{pdfpages} permite incluir páginas de documentos PDF externos
en el documento \LaTeX. Esto es útil para adjuntar:
\begin{itemize}
  \item Artículos o papers de referencia
  \item Documentación técnica de terceros
  \item Certificados o autorizaciones
  \item Manuales de usuario existentes
  \item Hojas de datos (datasheets)
\end{itemize}

\subsection{Sintaxis básica}

\begin{latexcode}[title={Inclusión de PDF externo}]
% Incluir todas las páginas
\includepdf[pages=-]{ruta/documento.pdf}

% Incluir páginas específicas
\includepdf[pages={1,3,5-8}]{documento.pdf}

% Incluir con opciones
\includepdf[
  pages=-,
  scale=0.9,
  pagecommand={\thispagestyle{plain}}
]{documento.pdf}
\end{latexcode}

\subsection{Opciones más utilizadas}

\begin{table}[H]
  \centering
  \caption{Opciones principales de \texttt{\textbackslash includepdf}}
  \label{tab:opciones-includepdf}
  \begin{tabular}{lp{8cm}}
    \toprule
    \textbf{Opción} & \textbf{Descripción} \\
    \midrule
    \texttt{pages=-} & Incluye todas las páginas \\
    \texttt{pages=\{1,3,5-8\}} & Incluye páginas específicas \\
    \texttt{scale=0.9} & Escala el documento (0.9 = 90\%) \\
    \texttt{landscape} & Rota las páginas 90 grados \\
    \texttt{nup=2x2} & Coloca varias páginas en una (2 filas × 2 columnas) \\
    \texttt{frame} & Añade un marco alrededor de cada página \\
    \texttt{pagecommand=\{\}} & Comando a ejecutar en cada página incluida \\
    \texttt{addtotoc} & Añade entrada al índice de contenidos \\
    \bottomrule
  \end{tabular}
\end{table}

\subsection{Ejemplo: Documento PDF incluido}

A continuación se incluye un documento PDF de ejemplo que ha sido generado 
independientemente. Se incluyen sus dos páginas con un marco y una escala 
ligeramente reducida:

% Incluir el PDF externo de ejemplo
\includepdf[
  pages=-,
  scale=0.85,
  frame,
  pagecommand={\thispagestyle{plain}},
]{recursos/pdf_externos/documento_ejemplo.pdf}

\subsection{Múltiples páginas en una hoja}

Para ahorrar espacio, se pueden incluir varias páginas del PDF en una sola 
hoja del documento:

\begin{latexcode}[title={Varias páginas PDF en una hoja}]
\includepdf[
  pages=-,
  nup=1x2,           % 1 columna, 2 filas
  landscape,         % Orientación horizontal
  frame,             % Marco visible
]{documento.pdf}
\end{latexcode}

%% =============================================================================
\section{Figuras de Ancho Completo}
\label{sec:figuras-ancho-completo}

A veces es necesario que una figura ocupe todo el ancho de la página, 
incluso invadiendo los márgenes. Para ello se combina el entorno 
\texttt{figure*} con ajustes de geometría.

\subsection{Figura que invade márgenes}

\begin{latexcode}[title={Figura de ancho completo}]
\begin{figure}[H]
  \centering
  \makebox[\textwidth][c]{%
    \includegraphics[width=1.2\textwidth]{imagen_ancha}
  }
  \caption{Imagen que ocupa más que el ancho del texto}
\end{figure}
\end{latexcode}

%% =============================================================================
\section{Notas al Margen}
\label{sec:notas-margen}

Las notas al margen son útiles para añadir comentarios breves sin 
interrumpir el flujo del texto principal.

\subsection{Uso básico}

\begin{latexcode}[title={Notas al margen}]
Texto principal del párrafo.\marginpar{Nota breve al margen}
\end{latexcode}

Este es un ejemplo de texto con una nota al margen.\marginpar{\footnotesize\textit{Esta es una nota al margen con información adicional.}}

Las notas al margen se colocan automáticamente en el lado exterior de la 
página (derecho en páginas impares, izquierdo en pares) cuando se usa 
impresión a doble cara.

%% =============================================================================
\section{Marcas de Agua}
\label{sec:marcas-agua}

Para documentos en borrador o confidenciales, se pueden añadir marcas de agua
usando el paquete \texttt{draftwatermark} o \texttt{background}.

\begin{latexcode}[title={Marca de agua con draftwatermark}]
% En el preámbulo:
\usepackage{draftwatermark}
\SetWatermarkText{BORRADOR}
\SetWatermarkScale{1.5}
\SetWatermarkColor[gray]{0.9}
\end{latexcode}

%% =============================================================================
\section{Texto en Columnas}
\label{sec:columnas}

Para secciones específicas que requieran formato en múltiples columnas
(como glosarios o listas de referencias), se puede usar el entorno
\texttt{multicols}:

\begin{latexcode}[title={Texto en dos columnas}]
\begin{multicols}{2}
  Contenido distribuido en dos columnas...
\end{multicols}
\end{latexcode}

\subsection{Ejemplo de texto en columnas}

\begin{multicols}{2}
\small
\textbf{Términos de red:}
\begin{itemize}[noitemsep]
  \item Router
  \item Switch
  \item Firewall
  \item Gateway
  \item DNS Server
  \item DHCP Server
\end{itemize}

\columnbreak

\textbf{Protocolos:}
\begin{itemize}[noitemsep]
  \item TCP/IP
  \item HTTP/HTTPS
  \item FTP/SFTP
  \item SSH
  \item SMTP
  \item DNS
\end{itemize}
\end{multicols}

%% =============================================================================
\section{Minipáginas y Cajas}
\label{sec:minipaginas}

Las minipáginas permiten crear bloques de contenido lado a lado:

\begin{latexcode}[title={Dos minipáginas lado a lado}]
\begin{minipage}[t]{0.45\textwidth}
  Contenido izquierdo...
\end{minipage}
\hfill
\begin{minipage}[t]{0.45\textwidth}
  Contenido derecho...
\end{minipage}
\end{latexcode}

\subsection{Ejemplo de minipáginas}

\noindent
\begin{minipage}[t]{0.48\textwidth}
  \textbf{Ventajas del sistema:}
  \begin{itemize}[noitemsep]
    \item Alta disponibilidad
    \item Escalabilidad horizontal
    \item Bajo coste de mantenimiento
    \item Interfaz intuitiva
    \item Documentación completa
  \end{itemize}
\end{minipage}
\hfill
\begin{minipage}[t]{0.48\textwidth}
  \textbf{Limitaciones conocidas:}
  \begin{itemize}[noitemsep]
    \item Requiere conexión a Internet
    \item No compatible con IE11
    \item Máximo 1000 usuarios simultáneos
    \item Sin soporte para móviles legacy
    \item Idiomas: solo ES/EN
  \end{itemize}
\end{minipage}

%% =============================================================================
\section{Resumen de Paquetes Utilizados}
\label{sec:resumen-paquetes}

\begin{table}[H]
  \centering
  \caption{Paquetes y comandos \LaTeX{} para técnicas avanzadas}
  \label{tab:paquetes-avanzados}
  \begin{tabular}{llp{6cm}}
    \toprule
    \textbf{Paquete/Clase} & \textbf{Uso} & \textbf{Comando principal} \\
    \midrule
    \texttt{rotating} & Tablas rotadas & \verb|\begin{sidewaystable}| \\
    KOMA-Script & Páginas landscape & \verb|\KOMAoptions{paper=landscape}| \\
    \texttt{pdfpages} & Incluir PDFs & \verb|\includepdf[options]{file}| \\
    \texttt{multicol} & Múltiples columnas & \verb|\begin{multicols}{n}| \\
    \texttt{geometry} & Márgenes personalizados & \verb|\newgeometry{...}| \\
    \texttt{scrlayer-scrpage} & Encabezados/pies & Configuración KOMA \\
    \texttt{draftwatermark} & Marcas de agua & \verb|\SetWatermarkText{...}| \\
    \bottomrule
  \end{tabular}
\end{table}
